
\documentclass[border=8pt, multi, tikz]{standalone} 
\usepackage{import}
\subimport{../PlotNeuralNet/layers/}{init}
\usetikzlibrary{positioning}
\usetikzlibrary{3d} %for including external image 
\usetikzlibrary{calc}
\usetikzlibrary{positioning}
\usetikzlibrary{backgrounds}
\usetikzlibrary{decorations.pathreplacing}
\usetikzlibrary{fit}
\usetikzlibrary{arrows.meta}

\def\ConvColor{rgb:yellow,5;red,2.5;white,5}
\def\ConvReluColor{rgb:yellow,5;red,5;white,5}
\def\PoolColor{rgb:red,1;black,0.3}
\def\UnpoolColor{rgb:blue,2;green,1;black,0.3}
\def\FcColor{rgb:blue,5;red,2.5;white,5}
\def\FcReluColor{rgb:blue,5;red,5;white,4}
\def\SoftmaxColor{rgb:magenta,5;black,7}   
\def\SumColor{rgb:blue,5;green,15}

\newcommand{\copymidarrow}{\tikz \draw[-Stealth,line width=0.8mm,draw={rgb:blue,4;red,1;green,1;black,3}] (-0.3,0) -- ++(0.3,0);}

\begin{document}
\begin{tikzpicture}
\tikzstyle{connection}=[ultra thick,every node/.style={sloped,allow upside down},draw=\edgecolor,opacity=0.7]
\tikzstyle{copyconnection}=[ultra thick,every node/.style={sloped,allow upside down},draw={rgb:blue,4;red,1;green,1;black,3},opacity=0.7]
\begin{scope}[scale=1.45]
\node[inner sep=0pt, rounded corners=5pt, draw=gray!60!black, line width=0.9pt]      (rgb_sample_0) at (-20.0,15.3,0) {\includegraphics[width=3.1cm]{assets/avion_rgb/frame_0000.png}};\node[inner sep=0pt, rounded corners=5pt, draw=gray!60!black, line width=0.9pt]      (rgb_sample_1) at ($(rgb_sample_0.south) + (0,-1.65,0)$) {\includegraphics[width=3.1cm]{assets/avion_rgb/frame_0004.png}};\node[font=\Huge, text=gray!70!black]      (rgb_sample_dots) at ($(rgb_sample_1.south) + (0,-1.35,0)$) {\vdots};\node[inner sep=0pt, rounded corners=5pt, draw=gray!60!black, line width=0.9pt]      (rgb_sample_last) at ($(rgb_sample_dots.south) + (0,-1.45,0)$) {\includegraphics[width=3.1cm]{assets/avion_rgb/frame_0011.png}};\node[font=\small\bfseries, text=gray!60!black] at ($(rgb_sample_0.south) + (0,-0.32)$) {Frame $I_0$};\node[font=\small\bfseries, text=gray!60!black] at ($(rgb_sample_1.south) + (0,-0.32)$) {Frame $P_1$};\node[font=\small\bfseries, text=gray!60!black] at ($(rgb_sample_last.south) + (0,-0.32)$) {Frame $P_{11}$};\node[draw=black!70!gray, line width=1.6pt, rounded corners=10pt,      inner xsep=14pt, inner ysep=22pt, fit={(rgb_sample_0) (rgb_sample_1) (rgb_sample_last) (rgb_sample_dots)}] (gop_block) {};\node[anchor=north, font=\Large\bfseries, text=gray!70!black]      at ($(gop_block.north) + (0,0.60,0)$) {Group of Pictures};\node[draw=black!70!gray, line width=1.6pt, fill=black!6, rounded corners=8pt,      minimum width=4.4cm, minimum height=2.6cm, align=center, font=\Large,      name=camera_src] at ($(rgb_sample_1.west) + (-2.8,-1.25,0)$) {\textbf{Camera feed}\\Raw sensor frames\\{\large GOP$_n$: I$_0$ + 11 P}};\node[draw=black!70!gray, line width=1.6pt, fill=black!6, rounded corners=8pt,      minimum width=4.4cm, minimum height=2.4cm, align=center, font=\Large,      name=codec] at ($(camera_src.east) + (6.3,-0.0,0)$) {\textbf{Compression codec}\\Mpeg4 Part2 \\ Encoding};\draw[-{Stealth[length=8pt,width=7pt]}, thick, draw=purple!75!black]    (camera_src.east) -- ($(rgb_sample_0.west)+(-0.35,0)$) -- (rgb_sample_0.west);\draw[-{Stealth[length=8pt,width=7pt]}, thick, draw=purple!75!black]    (rgb_sample_0.east) -- ($(rgb_sample_0.east)+(0.2,0)$) -- (codec.west);\draw[-{Stealth[length=8pt,width=7pt]}, thick, draw=blue!70!black]    (camera_src.east) -- ($(rgb_sample_1.west)+(-0.35,0)$) -- (rgb_sample_1.west);\draw[-{Stealth[length=8pt,width=7pt]}, thick, draw=blue!70!black]    (rgb_sample_1.east) -- ($(rgb_sample_1.east)+(0.2,0)$) -- (codec.west);\draw[-{Stealth[length=8pt,width=7pt]}, thick, draw=blue!70!black]    (camera_src.east) -- ($(rgb_sample_last.west)+(-0.35,0)$) -- (rgb_sample_last.west);\draw[-{Stealth[length=8pt,width=7pt]}, thick, draw=blue!70!black]    (rgb_sample_last.east) -- ($(rgb_sample_last.east)+(0.2,0)$) -- (codec.west);
% Codec outputs (motion vectors and residuals)
\path let \p1 = (rgb_sample_1), \p2 = (codec.east) in    node[inner sep=0pt, rounded corners=5pt, draw=blue!60!black, line width=0.9pt]      (mv_sample_0) at (\x2+2.2cm,\y1) {\includegraphics[width=3.0cm]{assets/avion_rgb/motion_0004.png}};\node[font=\Huge, text=blue!60!black]      (mv_sample_dots) at ($(mv_sample_0.south) + (0,-1.30)$) {\vdots};\path let \p1 = (rgb_sample_last), \p2 = (codec.east) in    node[inner sep=0pt, rounded corners=5pt, draw=blue!60!black, line width=0.9pt]      (mv_sample_1) at (\x2+2.2cm,\y1) {\includegraphics[width=3.0cm]{assets/avion_rgb/motion_0011.png}};\path let \p1 = (rgb_sample_0), \p2 = (codec.south east) in    node[inner sep=0pt, rounded corners=5pt, draw=purple!70!black, line width=0.9pt]      (res_sample_initial) at (\x2+4.3cm,\y1) {\includegraphics[width=3.0cm]{assets/avion_rgb/residual_0000.png}};\path let \p1 = (rgb_sample_1), \p2 = (codec.south east) in    node[inner sep=0pt, rounded corners=5pt, draw=purple!70!black, line width=0.9pt]      (res_sample_0) at (\x2+4.3cm,\y1) {\includegraphics[width=3.0cm]{assets/avion_rgb/residual_0004.png}};\node[font=\Huge, text=purple!60!black]      (res_sample_dots) at ($(res_sample_0.south) + (0,-1.30)$) {\vdots};\path let \p1 = (rgb_sample_last), \p2 = (codec.south east) in    node[inner sep=0pt, rounded corners=5pt, draw=purple!70!black, line width=0.9pt]      (res_sample_1) at (\x2+4.3cm,\y1) {\includegraphics[width=3.0cm]{assets/avion_rgb/residual_0011.png}};\node[font=\small\bfseries, text=gray!60!black] at ($(mv_sample_0.south) + (0,-0.32)$) {Motion vectors $P_1$};\node[font=\small\bfseries, text=gray!60!black] at ($(mv_sample_1.south) + (0,-0.32)$) {Motion vectors $P_{11}$};\node[font=\small\bfseries, text=gray!60!black, align=center] at ($(res_sample_initial.south) + (0,-0.32)$) {Spatial encoding $I_0$};\node[font=\small\bfseries, text=gray!60!black] at ($(res_sample_0.south) + (0,-0.32)$) {Residuals $P_1$};\node[font=\small\bfseries, text=gray!60!black] at ($(res_sample_1.south) + (0,-0.32)$) {Residuals $P_{11}$};\draw[-{Stealth[length=8pt,width=7pt]}, thick, draw=blue!70!black]    (codec.east) -- ($(mv_sample_0.west)+(-0.35,0)$) -- (mv_sample_0.west);\draw[-{Stealth[length=8pt,width=7pt]}, thick, draw=blue!70!black]    (codec.east) -- ($(mv_sample_1.west)+(-0.35,0)$) -- (mv_sample_1.west);\draw[-{Stealth[length=8pt,width=7pt]}, thick, draw=purple!75!black]    (codec.east) -- ($(res_sample_initial.west)+(-2.45,0)$) -- (res_sample_initial.west);\node[draw=black!70!gray, line width=1.6pt, rounded corners=10pt,      inner xsep=14pt, inner ysep=22pt, fit={ (mv_sample_0) (mv_sample_1) (mv_sample_dots) (res_sample_initial) (res_sample_0) (res_sample_dots) (res_sample_1)}]      (codec_block) {};\node[anchor=north, font=\Large\bfseries, text=gray!70!black]      at ($(codec_block.north) + (0,0.6,0)$) {Compressed Data};\node[draw=purple!80!black, line width=1.4pt, fill=purple!6, rounded corners=7pt,      minimum width=5.4cm, minimum height=2.6cm, align=center, font=\Large,      name=spectra_i] at ($(res_sample_initial.east) + (3.,0,0)$) {\textbf{SpectraDet-I}\\Compressed spatial detector};\node[draw=blue!80!black, line width=1.3pt, fill=blue!6, rounded corners=7pt,      minimum width=5.4cm, minimum height=2.4cm, align=center, font=\Large,      name=spectra_p1] at ($(res_sample_0.east) + (3.2,0,0)$) {\textbf{SpectraDet-P}\\Residual + motion detector};\node[draw=blue!80!black, line width=1.3pt, fill=blue!6, rounded corners=7pt,      minimum width=5.4cm, minimum height=2.4cm, align=center, font=\Large,      name=spectra_p11] at ($(res_sample_1.east) + (3.2,0,0)$) {\textbf{SpectraDet-P}\\Residual + motion detector};\node[font=\Huge, text=blue!60!black]      (spectra_p_dots) at ($(spectra_p1.south)!0.50!(spectra_p11.north)$) {\vdots};\draw[-{Stealth[length=8pt,width=7pt]}, thick, draw=purple!75!black]    ($(res_sample_initial.east)$) -- ($(spectra_i.west) $);\draw[-{Stealth[length=8pt,width=7pt]}, thick, draw=blue!75!black]    ($(res_sample_0.east) $) -- ($(spectra_p1.west) $);\draw[-{Stealth[length=8pt,width=7pt]}, thick, draw=blue!75!black]    ($(res_sample_1.east) $) -- ($(spectra_p11.west) $);\node[draw=black!70!gray, line width=1.6pt, rounded corners=10pt,      inner xsep=14pt, inner ysep=24pt, fit={(spectra_i) (spectra_p1) (spectra_p_dots) (spectra_p11)}] (spectra_block) {};\node[anchor=north, font=\Large\bfseries, text=gray!70!black]      at ($(spectra_block.north) + (0,0.60,0)$) {SpectraFlow};\draw[-{Stealth[length=8pt,width=7pt]}, thick, draw=blue!65!black, dash pattern=on 2pt off 2pt on 1pt off 2pt]    ($(spectra_i.east)$) -- ($(spectra_i.east)+(1.1,0)$) -- ($(spectra_i.east)+(1.1,-1.4)$) -- ($(spectra_p1.west)+(-0.3,1.3)$) -- ($(spectra_p1.west)+(-0.3,0)$) -- ($(spectra_p1.west)$);\draw[-{Stealth[length=8pt,width=7pt]}, thick, draw=blue!65!black, dash pattern=on 2pt off 2pt on 1pt off 2pt]    ($(spectra_p1.east)$) -- ($(spectra_p1.east)+(1.1,0)$) -- ($(spectra_p1.east)+(1.1,-1.8)$) -- ($(spectra_p_dots.west)+(0.0,0.25)$) --($(spectra_p_dots.north)$)    node[pos=0.55, above=2pt, text=gray!60!black, font=\small\bfseries]{P$_{2}$ boxes};\draw[-{Stealth[length=8pt,width=7pt]}, thick, draw=blue!65!black, dash pattern=on 2pt off 2pt on 1pt off 2pt]    ($(spectra_p_dots.south)$) -- ($(spectra_p_dots.south)$) -- ($(spectra_p11.west)+(-0.4,1.8)$) -- ($(spectra_p11.west)+(-0.4,0)$) -- ($(spectra_p11.west)$)    node[pos=6.25, below=-65pt, text=gray!60!black, font=\small\bfseries]{P$_{10}$ boxes};\coordinate (bbox_x_anchor) at ($(spectra_i)+(6.0,0)$);\path let \p1 = (bbox_x_anchor), \p2 = (spectra_i) in    node[inner sep=0pt, rounded corners=5pt, draw=red!70!black, line width=1.0pt]      (bbox_rgb_0) at (\x1,\y2) {\includegraphics[width=3.1cm]{assets/avion_rgb/frame_0000.png}};\path let \p1 = (bbox_x_anchor), \p2 = (spectra_p1) in    node[inner sep=0pt, rounded corners=5pt, draw=red!70!black, line width=1.0pt]      (bbox_rgb_1) at (\x1,\y2) {\includegraphics[width=3.1cm]{assets/avion_rgb/frame_0004.png}};\node[font=\Huge, text=gray!60!black]      (bbox_rgb_dots) at ($(bbox_rgb_1.south) + (0,-1.30)$) {\vdots};\path let \p1 = (bbox_x_anchor), \p2 = (spectra_p11) in    node[inner sep=0pt, rounded corners=5pt, draw=red!70!black, line width=1.0pt]      (bbox_rgb_last) at (\x1,\y2) {\includegraphics[width=3.1cm]{assets/avion_rgb/frame_0011.png}};\draw[red!80!black, line width=1.1pt, rounded corners=2pt]    ($(bbox_rgb_0.south west)+(0.55,0.35)$) rectangle ($(bbox_rgb_0.south west)+(1.80,2.05)$);\draw[red!80!black, line width=1.1pt, rounded corners=2pt]    ($(bbox_rgb_1.south west)+(0.50,0.35)$) rectangle ($(bbox_rgb_1.south west)+(1.75,2.05)$);\draw[red!80!black, line width=1.1pt, rounded corners=2pt]    ($(bbox_rgb_last.south west)+(0.50,0.35)$) rectangle ($(bbox_rgb_last.south west)+(1.75,2.05)$);\node[font=\small\bfseries, text=gray!60!black] at ($(bbox_rgb_0.south) + (0,-0.32)$) {Detected $I_0$};\node[font=\small\bfseries, text=gray!60!black] at ($(bbox_rgb_1.south) + (0,-0.32)$) {Detected $P_1$};\node[font=\small\bfseries, text=gray!60!black] at ($(bbox_rgb_last.south) + (0,-0.32)$) {Detected $P_{11}$};\draw[-{Stealth[length=8pt,width=7pt]}, thick, draw=blue!65!black, dash pattern=on 2pt off 2pt on 1pt off 2pt]    ($(spectra_i.east)+(0.2,0)$) -- ($(bbox_rgb_0.west)+(-0.4,0)$)    node[pos=0.42, above=4pt, text=gray!60!black, font=\small\bfseries]{I$_0$ boxes};\draw[-{Stealth[length=8pt,width=7pt]}, thick, draw=blue!65!black, dash pattern=on 2pt off 2pt on 1pt off 2pt]    ($(spectra_p1.east)+(0.2,0)$) -- ($(bbox_rgb_1.west)+(-0.4,0)$)    node[pos=0.50, above=4pt, text=gray!60!black, font=\small\bfseries]{P$_1$ boxes};\draw[-{Stealth[length=8pt,width=7pt]}, thick, draw=blue!65!black, dash pattern=on 2pt off 2pt on 1pt off 2pt]    ($(spectra_p11.east)+(0.2,0)$) -- ($(bbox_rgb_last.west)+(-0.4,0)$)    node[pos=0.50, above=4pt, text=gray!60!black, font=\small\bfseries]{P$_{11}$ boxes};\node[draw=black!70!gray, line width=1.6pt, rounded corners=10pt,      inner xsep=12pt, inner ysep=18pt, fit={(bbox_rgb_0) (bbox_rgb_1) (bbox_rgb_dots) (bbox_rgb_last)}] (detected_block) {};\node[anchor=north, font=\Large\bfseries, text=gray!70!black]      at ($(detected_block.north) + (0,0.60,0)$) {Detected Boxes};\end{scope}
\end{tikzpicture}
\end{document}
